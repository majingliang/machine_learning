import pandas as pd
import numpy as np
import sys
sys.path.append('/Users/slade/Documents/GitHub/machine_learning/FM/script/')

from fm import fm
#local path
path = '/Users/slade/Documents/GitHub/machine_learning/data/data_all.txt'

#create model
model = fm(iter = 1)

#fit
model.fit(path)
# In [11]: model.fit(a)
# the no 0 times, the loss arrach 正方向

#predict
X = pd.read_table(path)
#第一列是手机号，第二列是因变量，都去掉
X = np.array(X.iloc[:,2:])
model.predict(X)
# [0.0068623909053069695,
# 0.03070660744280522,
# 0.62197610204590048,
# 0.11532505686311838,
# 0.020968338370392487,
# 0.017638116663948621,
# 0.01831564127277888,
# 0.10688694669470335,
#  ...]


#_w
model._w
# array([[-1.08728341],
#        [ 0.11213358],
#        [ 0.05307469],
#        [-1.68175973],
#        [-0.01022176],
#        [-0.0144888 ],
#        [-1.37021031],
#        [-1.13095253],
#        [-0.12314619]])

#_v
model._v
# array([[ 0.0764419 ,  0.0764419 ,  0.0764419 ,  0.0764419 ,  0.0764419 ,
#          0.0764419 ,  0.0764419 ,  0.0764419 ],
#        [ 0.3254763 ,  0.3254763 ,  0.3254763 ,  0.3254763 ,  0.3254763 ,
#          0.3254763 ,  0.3254763 ,  0.3254763 ],
#        [ 0.35334494,  0.35334494,  0.35334494,  0.35334494,  0.35334494,
#          0.35334494,  0.35334494,  0.35334494],
#        [-0.1346388 , -0.1346388 , -0.1346388 , -0.1346388 , -0.1346388 ,
#         -0.1346388 , -0.1346388 , -0.1346388 ],
#        [ 0.34120166,  0.34120166,  0.34120166,  0.34120166,  0.34120166,
#          0.34120166,  0.34120166,  0.34120166],
#        [ 0.34007967,  0.34007967,  0.34007967,  0.34007967,  0.34007967,
#          0.34007967,  0.34007967,  0.34007967],
#        [ 0.05097865,  0.05097865,  0.05097865,  0.05097865,  0.05097865,
#          0.05097865,  0.05097865,  0.05097865],
#        [ 0.12091724,  0.12091724,  0.12091724,  0.12091724,  0.12091724,
#          0.12091724,  0.12091724,  0.12091724],
#        [ 0.28326789,  0.28326789,  0.28326789,  0.28326789,  0.28326789,
#          0.28326789,  0.28326789,  0.28326789]])

#_w_0
model._w_0
#-1.8927186959057687